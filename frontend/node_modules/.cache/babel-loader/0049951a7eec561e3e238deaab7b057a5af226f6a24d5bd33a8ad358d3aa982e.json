{"ast":null,"code":"/**\r\n * backend/routes/orders.js\r\n *\r\n *\r\n *\r\n * Endpoints:\r\n * - POST   /api/orders         -> Tạo đơn hàng và trả về URL thanh toán VNPay\r\n * - GET    /api/orders/my-orders -> Lấy danh sách đơn hàng của user hiện tại\r\n * - GET    /api/orders/vnpay_return -> VNPay redirect (callback) sau thanh toán, kiểm tra chữ ký và cập nhật trạng thái đơn\r\n *\r\n */\n\nconst express = require(\"express\");\nconst router = express.Router();\nconst Order = require(\"../models/Order\");\nconst {\n  auth\n} = require(\"../middleware/auth\");\nconst crypto = require(\"crypto\");\nconst config = require(\"config\"); // Import config để đọc default.json\n\n/**\r\n * Các hàm trợ giúp nội bộ để xử lý chữ ký VNPay.\r\n * Dựa theo demo VNPay: https://sandbox.vnpayment.vn/apis/docs/huong-dan-tich-hop/\r\n */\n\n/**\r\n * sortObject(obj)\r\n * - Sắp xếp object theo key (giống demo VNPay)\r\n */\nfunction sortObject(obj) {\n  let sorted = {};\n  let str = [];\n  let key;\n  for (key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      str.push(encodeURIComponent(key));\n    }\n  }\n  str.sort();\n  for (key = 0; key < str.length; key++) {\n    sorted[str[key]] = encodeURIComponent(obj[str[key]]).replace(/%20/g, \"+\");\n  }\n  return sorted;\n}\n\n/**\r\n * POST /api/orders\r\n * - Yêu cầu: user phải auth (middleware auth)\r\n * - Body: { items: [{product, name, price, quantity, imageUrl}], shippingAddress, totalAmount }\r\n * - Tạo record Order, sau đó sinh URL thanh toán VNPay và trả về cho frontend.\r\n */\nrouter.post(\"/\", auth, async (req, res) => {\n  try {\n    const {\n      items,\n      shippingAddress,\n      totalAmount\n    } = req.body;\n\n    // Validate cơ bản\n    if (!Array.isArray(items) || items.length === 0) {\n      return res.status(400).json({\n        message: \"items required\"\n      });\n    }\n    if (typeof totalAmount !== \"number\" || Number.isNaN(totalAmount) || totalAmount <= 0) {\n      return res.status(400).json({\n        message: \"totalAmount required and must be a positive number\"\n      });\n    }\n\n    // Tạo đơn hàng trong DB (chưa tính trạng thái thanh toán)\n    const order = new Order({\n      user: req.user._id,\n      items,\n      totalAmount,\n      shippingAddress\n    });\n    await order.save();\n\n    // Sinh URL VNPay\n    const vnpUrl = generateVNPayUrl(order, req);\n    return res.status(201).json({\n      orderId: order._id,\n      paymentUrl: vnpUrl\n    });\n  } catch (error) {\n    console.error(\"Create order error:\", error);\n    return res.status(500).json({\n      message: \"Server error\",\n      error: error.message\n    });\n  }\n});\n\n/**\r\n * GET /api/orders/my-orders\r\n * - Trả về danh sách đơn hàng của user hiện tại (đã authenticate)\r\n */\nrouter.get(\"/my-orders\", auth, async (req, res) => {\n  try {\n    const orders = await Order.find({\n      user: req.user._id\n    }).sort({\n      createdAt: -1\n    }).populate(\"items.product\");\n    return res.json(orders);\n  } catch (error) {\n    console.error(\"Fetch my orders error:\", error);\n    return res.status(500).json({\n      message: \"Server error\",\n      error: error.message\n    });\n  }\n});\n\n/**\r\n * GET /api/orders/vnpay_return\r\n * - VNPay redirect về endpoint này sau khi người dùng thanh toán.\r\n * - Theo demo VNPay, endpoint phải là vnpay_return (có gạch dưới)\r\n */\nrouter.get(\"/vnpay_return\", async (req, res) => {\n  try {\n    let vnp_Params = req.query;\n    let secureHash = vnp_Params[\"vnp_SecureHash\"];\n    delete vnp_Params[\"vnp_SecureHash\"];\n    delete vnp_Params[\"vnp_SecureHashType\"];\n    vnp_Params = sortObject(vnp_Params);\n    let tmnCode = config.get(\"vnp_TmnCode\");\n    let secretKey = config.get(\"vnp_HashSecret\");\n    let signData = require(\"querystring\").stringify(vnp_Params, {\n      encode: false\n    });\n    let hmac = crypto.createHmac(\"sha512\", secretKey);\n    let signed = hmac.update(Buffer.from(signData, \"utf-8\")).digest(\"hex\");\n    console.log(\"[VNPAY] signData:\", signData);\n    console.log(\"[VNPAY] computed hash:\", signed);\n    console.log(\"[VNPAY] incoming hash:\", secureHash);\n    if (secureHash === signed) {\n      // Chữ ký hợp lệ\n      let orderId = vnp_Params[\"vnp_TxnRef\"];\n      let rspCode = vnp_Params[\"vnp_ResponseCode\"];\n      console.log(\"[VNPAY] Valid signature. OrderId:\", orderId, \"ResponseCode:\", rspCode);\n      if (rspCode === \"00\") {\n        // Thanh toán thành công\n        try {\n          await Order.findByIdAndUpdate(orderId, {\n            paymentStatus: \"paid\",\n            orderStatus: \"processing\"\n          });\n          console.log(\"[VNPAY] Order updated successfully\");\n        } catch (err) {\n          console.error(\"[VNPAY] Update order error:\", err);\n        }\n      }\n\n      // Redirect về frontend\n      const returnUrl = config.get(\"vnp_ReturnUrl\") || \"http://localhost:3000/payment-result\";\n      return res.redirect(`${returnUrl}?status=${rspCode}`);\n    } else {\n      // Chữ ký không hợp lệ\n      console.warn(\"[VNPAY] Invalid signature\");\n      const returnUrl = config.get(\"vnp_ReturnUrl\") || \"http://localhost:3000/payment-result\";\n      return res.redirect(`${returnUrl}?status=97&message=invalid_signature`);\n    }\n  } catch (error) {\n    console.error(\"[VNPAY] Return handler error:\", error);\n    return res.status(500).send(\"Server error\");\n  }\n});\n\n/**\r\n * generateVNPayUrl(order, req)\r\n * - Xây dựng URL thanh toán VNPay theo đúng demo của VNPay\r\n */\nfunction generateVNPayUrl(order, req) {\n  process.env.TZ = \"Asia/Ho_Chi_Minh\";\n  let date = new Date();\n  let createDate = formatDate(date);\n  let ipAddr = req.headers[\"x-forwarded-for\"] || req.connection.remoteAddress || req.socket.remoteAddress || req.connection.socket.remoteAddress;\n  let tmnCode = config.get(\"vnp_TmnCode\");\n  let secretKey = config.get(\"vnp_HashSecret\");\n  let vnpUrl = config.get(\"vnp_Url\");\n  let returnUrl = config.get(\"vnp_ReturnUrl\");\n  let orderId = order._id.toString();\n  let amount = Math.round(order.totalAmount);\n  let bankCode = \"\";\n  let locale = \"vn\";\n  let currCode = \"VND\";\n  let vnp_Params = {};\n  vnp_Params[\"vnp_Version\"] = \"2.1.0\";\n  vnp_Params[\"vnp_Command\"] = \"pay\";\n  vnp_Params[\"vnp_TmnCode\"] = tmnCode;\n  vnp_Params[\"vnp_Locale\"] = locale;\n  vnp_Params[\"vnp_CurrCode\"] = currCode;\n  vnp_Params[\"vnp_TxnRef\"] = orderId;\n  vnp_Params[\"vnp_OrderInfo\"] = \"Thanh toan don hang:\" + orderId;\n  vnp_Params[\"vnp_OrderType\"] = \"other\";\n  vnp_Params[\"vnp_Amount\"] = amount * 100;\n  vnp_Params[\"vnp_ReturnUrl\"] = returnUrl;\n  vnp_Params[\"vnp_IpAddr\"] = ipAddr;\n  vnp_Params[\"vnp_CreateDate\"] = createDate;\n  if (bankCode !== null && bankCode !== \"\") {\n    vnp_Params[\"vnp_BankCode\"] = bankCode;\n  }\n  vnp_Params = sortObject(vnp_Params);\n  let signData = require(\"querystring\").stringify(vnp_Params, {\n    encode: false\n  });\n  let hmac = crypto.createHmac(\"sha512\", secretKey);\n  let signed = hmac.update(Buffer.from(signData, \"utf-8\")).digest(\"hex\");\n  vnp_Params[\"vnp_SecureHash\"] = signed;\n  vnpUrl += \"?\" + require(\"querystring\").stringify(vnp_Params, {\n    encode: false\n  });\n  console.log(\"[VNPAY] Payment URL:\", vnpUrl);\n  console.log(\"[VNPAY] signData:\", signData);\n  console.log(\"[VNPAY] SecureHash:\", signed);\n  return vnpUrl;\n}\n\n/**\r\n * formatDate - Format date theo yêu cầu VNPay: yyyyMMddHHmmss\r\n */\nfunction formatDate(date) {\n  let d = new Date(date),\n    month = \"\" + (d.getMonth() + 1),\n    day = \"\" + d.getDate(),\n    year = d.getFullYear(),\n    hour = \"\" + d.getHours(),\n    minute = \"\" + d.getMinutes(),\n    second = \"\" + d.getSeconds();\n  if (month.length < 2) month = \"0\" + month;\n  if (day.length < 2) day = \"0\" + day;\n  if (hour.length < 2) hour = \"0\" + hour;\n  if (minute.length < 2) minute = \"0\" + minute;\n  if (second.length < 2) second = \"0\" + second;\n  return [year, month, day, hour, minute, second].join(\"\");\n}\nmodule.exports = router;","map":{"version":3,"names":["express","require","router","Router","Order","auth","crypto","config","sortObject","obj","sorted","str","key","hasOwnProperty","push","encodeURIComponent","sort","length","replace","post","req","res","items","shippingAddress","totalAmount","body","Array","isArray","status","json","message","Number","isNaN","order","user","_id","save","vnpUrl","generateVNPayUrl","orderId","paymentUrl","error","console","get","orders","find","createdAt","populate","vnp_Params","query","secureHash","tmnCode","secretKey","signData","stringify","encode","hmac","createHmac","signed","update","Buffer","from","digest","log","rspCode","findByIdAndUpdate","paymentStatus","orderStatus","err","returnUrl","redirect","warn","send","process","env","TZ","date","Date","createDate","formatDate","ipAddr","headers","connection","remoteAddress","socket","toString","amount","Math","round","bankCode","locale","currCode","d","month","getMonth","day","getDate","year","getFullYear","hour","getHours","minute","getMinutes","second","getSeconds","join","module","exports"],"sources":["C:/Users/duyan/trangsucvn/frontend/src/pages/Cart.js"],"sourcesContent":["/**\r\n * backend/routes/orders.js\r\n *\r\n *\r\n *\r\n * Endpoints:\r\n * - POST   /api/orders         -> Tạo đơn hàng và trả về URL thanh toán VNPay\r\n * - GET    /api/orders/my-orders -> Lấy danh sách đơn hàng của user hiện tại\r\n * - GET    /api/orders/vnpay_return -> VNPay redirect (callback) sau thanh toán, kiểm tra chữ ký và cập nhật trạng thái đơn\r\n *\r\n */\r\n\r\nconst express = require(\"express\");\r\nconst router = express.Router();\r\nconst Order = require(\"../models/Order\");\r\nconst { auth } = require(\"../middleware/auth\");\r\nconst crypto = require(\"crypto\");\r\nconst config = require(\"config\"); // Import config để đọc default.json\r\n\r\n/**\r\n * Các hàm trợ giúp nội bộ để xử lý chữ ký VNPay.\r\n * Dựa theo demo VNPay: https://sandbox.vnpayment.vn/apis/docs/huong-dan-tich-hop/\r\n */\r\n\r\n/**\r\n * sortObject(obj)\r\n * - Sắp xếp object theo key (giống demo VNPay)\r\n */\r\nfunction sortObject(obj) {\r\n  let sorted = {};\r\n  let str = [];\r\n  let key;\r\n  for (key in obj) {\r\n    if (obj.hasOwnProperty(key)) {\r\n      str.push(encodeURIComponent(key));\r\n    }\r\n  }\r\n  str.sort();\r\n  for (key = 0; key < str.length; key++) {\r\n    sorted[str[key]] = encodeURIComponent(obj[str[key]]).replace(/%20/g, \"+\");\r\n  }\r\n  return sorted;\r\n}\r\n\r\n/**\r\n * POST /api/orders\r\n * - Yêu cầu: user phải auth (middleware auth)\r\n * - Body: { items: [{product, name, price, quantity, imageUrl}], shippingAddress, totalAmount }\r\n * - Tạo record Order, sau đó sinh URL thanh toán VNPay và trả về cho frontend.\r\n */\r\nrouter.post(\"/\", auth, async (req, res) => {\r\n  try {\r\n    const { items, shippingAddress, totalAmount } = req.body;\r\n\r\n    // Validate cơ bản\r\n    if (!Array.isArray(items) || items.length === 0) {\r\n      return res.status(400).json({ message: \"items required\" });\r\n    }\r\n    if (\r\n      typeof totalAmount !== \"number\" ||\r\n      Number.isNaN(totalAmount) ||\r\n      totalAmount <= 0\r\n    ) {\r\n      return res.status(400).json({\r\n        message: \"totalAmount required and must be a positive number\",\r\n      });\r\n    }\r\n\r\n    // Tạo đơn hàng trong DB (chưa tính trạng thái thanh toán)\r\n    const order = new Order({\r\n      user: req.user._id,\r\n      items,\r\n      totalAmount,\r\n      shippingAddress,\r\n    });\r\n\r\n    await order.save();\r\n\r\n    // Sinh URL VNPay\r\n    const vnpUrl = generateVNPayUrl(order, req);\r\n\r\n    return res.status(201).json({\r\n      orderId: order._id,\r\n      paymentUrl: vnpUrl,\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Create order error:\", error);\r\n    return res\r\n      .status(500)\r\n      .json({ message: \"Server error\", error: error.message });\r\n  }\r\n});\r\n\r\n/**\r\n * GET /api/orders/my-orders\r\n * - Trả về danh sách đơn hàng của user hiện tại (đã authenticate)\r\n */\r\nrouter.get(\"/my-orders\", auth, async (req, res) => {\r\n  try {\r\n    const orders = await Order.find({ user: req.user._id })\r\n      .sort({ createdAt: -1 })\r\n      .populate(\"items.product\");\r\n\r\n    return res.json(orders);\r\n  } catch (error) {\r\n    console.error(\"Fetch my orders error:\", error);\r\n    return res\r\n      .status(500)\r\n      .json({ message: \"Server error\", error: error.message });\r\n  }\r\n});\r\n\r\n/**\r\n * GET /api/orders/vnpay_return\r\n * - VNPay redirect về endpoint này sau khi người dùng thanh toán.\r\n * - Theo demo VNPay, endpoint phải là vnpay_return (có gạch dưới)\r\n */\r\nrouter.get(\"/vnpay_return\", async (req, res) => {\r\n  try {\r\n    let vnp_Params = req.query;\r\n    let secureHash = vnp_Params[\"vnp_SecureHash\"];\r\n\r\n    delete vnp_Params[\"vnp_SecureHash\"];\r\n    delete vnp_Params[\"vnp_SecureHashType\"];\r\n\r\n    vnp_Params = sortObject(vnp_Params);\r\n\r\n    let tmnCode = config.get(\"vnp_TmnCode\");\r\n    let secretKey = config.get(\"vnp_HashSecret\");\r\n\r\n    let signData = require(\"querystring\").stringify(vnp_Params, {\r\n      encode: false,\r\n    });\r\n    let hmac = crypto.createHmac(\"sha512\", secretKey);\r\n    let signed = hmac.update(Buffer.from(signData, \"utf-8\")).digest(\"hex\");\r\n\r\n    console.log(\"[VNPAY] signData:\", signData);\r\n    console.log(\"[VNPAY] computed hash:\", signed);\r\n    console.log(\"[VNPAY] incoming hash:\", secureHash);\r\n\r\n    if (secureHash === signed) {\r\n      // Chữ ký hợp lệ\r\n      let orderId = vnp_Params[\"vnp_TxnRef\"];\r\n      let rspCode = vnp_Params[\"vnp_ResponseCode\"];\r\n\r\n      console.log(\r\n        \"[VNPAY] Valid signature. OrderId:\",\r\n        orderId,\r\n        \"ResponseCode:\",\r\n        rspCode\r\n      );\r\n\r\n      if (rspCode === \"00\") {\r\n        // Thanh toán thành công\r\n        try {\r\n          await Order.findByIdAndUpdate(orderId, {\r\n            paymentStatus: \"paid\",\r\n            orderStatus: \"processing\",\r\n          });\r\n          console.log(\"[VNPAY] Order updated successfully\");\r\n        } catch (err) {\r\n          console.error(\"[VNPAY] Update order error:\", err);\r\n        }\r\n      }\r\n\r\n      // Redirect về frontend\r\n      const returnUrl =\r\n        config.get(\"vnp_ReturnUrl\") || \"http://localhost:3000/payment-result\";\r\n      return res.redirect(`${returnUrl}?status=${rspCode}`);\r\n    } else {\r\n      // Chữ ký không hợp lệ\r\n      console.warn(\"[VNPAY] Invalid signature\");\r\n      const returnUrl =\r\n        config.get(\"vnp_ReturnUrl\") || \"http://localhost:3000/payment-result\";\r\n      return res.redirect(`${returnUrl}?status=97&message=invalid_signature`);\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[VNPAY] Return handler error:\", error);\r\n    return res.status(500).send(\"Server error\");\r\n  }\r\n});\r\n\r\n/**\r\n * generateVNPayUrl(order, req)\r\n * - Xây dựng URL thanh toán VNPay theo đúng demo của VNPay\r\n */\r\nfunction generateVNPayUrl(order, req) {\r\n  process.env.TZ = \"Asia/Ho_Chi_Minh\";\r\n\r\n  let date = new Date();\r\n  let createDate = formatDate(date);\r\n  let ipAddr =\r\n    req.headers[\"x-forwarded-for\"] ||\r\n    req.connection.remoteAddress ||\r\n    req.socket.remoteAddress ||\r\n    req.connection.socket.remoteAddress;\r\n\r\n  let tmnCode = config.get(\"vnp_TmnCode\");\r\n  let secretKey = config.get(\"vnp_HashSecret\");\r\n  let vnpUrl = config.get(\"vnp_Url\");\r\n  let returnUrl = config.get(\"vnp_ReturnUrl\");\r\n  let orderId = order._id.toString();\r\n  let amount = Math.round(order.totalAmount);\r\n  let bankCode = \"\";\r\n\r\n  let locale = \"vn\";\r\n  let currCode = \"VND\";\r\n  let vnp_Params = {};\r\n  vnp_Params[\"vnp_Version\"] = \"2.1.0\";\r\n  vnp_Params[\"vnp_Command\"] = \"pay\";\r\n  vnp_Params[\"vnp_TmnCode\"] = tmnCode;\r\n  vnp_Params[\"vnp_Locale\"] = locale;\r\n  vnp_Params[\"vnp_CurrCode\"] = currCode;\r\n  vnp_Params[\"vnp_TxnRef\"] = orderId;\r\n  vnp_Params[\"vnp_OrderInfo\"] = \"Thanh toan don hang:\" + orderId;\r\n  vnp_Params[\"vnp_OrderType\"] = \"other\";\r\n  vnp_Params[\"vnp_Amount\"] = amount * 100;\r\n  vnp_Params[\"vnp_ReturnUrl\"] = returnUrl;\r\n  vnp_Params[\"vnp_IpAddr\"] = ipAddr;\r\n  vnp_Params[\"vnp_CreateDate\"] = createDate;\r\n  if (bankCode !== null && bankCode !== \"\") {\r\n    vnp_Params[\"vnp_BankCode\"] = bankCode;\r\n  }\r\n\r\n  vnp_Params = sortObject(vnp_Params);\r\n\r\n  let signData = require(\"querystring\").stringify(vnp_Params, {\r\n    encode: false,\r\n  });\r\n  let hmac = crypto.createHmac(\"sha512\", secretKey);\r\n  let signed = hmac.update(Buffer.from(signData, \"utf-8\")).digest(\"hex\");\r\n  vnp_Params[\"vnp_SecureHash\"] = signed;\r\n\r\n  vnpUrl +=\r\n    \"?\" + require(\"querystring\").stringify(vnp_Params, { encode: false });\r\n\r\n  console.log(\"[VNPAY] Payment URL:\", vnpUrl);\r\n  console.log(\"[VNPAY] signData:\", signData);\r\n  console.log(\"[VNPAY] SecureHash:\", signed);\r\n\r\n  return vnpUrl;\r\n}\r\n\r\n/**\r\n * formatDate - Format date theo yêu cầu VNPay: yyyyMMddHHmmss\r\n */\r\nfunction formatDate(date) {\r\n  let d = new Date(date),\r\n    month = \"\" + (d.getMonth() + 1),\r\n    day = \"\" + d.getDate(),\r\n    year = d.getFullYear(),\r\n    hour = \"\" + d.getHours(),\r\n    minute = \"\" + d.getMinutes(),\r\n    second = \"\" + d.getSeconds();\r\n\r\n  if (month.length < 2) month = \"0\" + month;\r\n  if (day.length < 2) day = \"0\" + day;\r\n  if (hour.length < 2) hour = \"0\" + hour;\r\n  if (minute.length < 2) minute = \"0\" + minute;\r\n  if (second.length < 2) second = \"0\" + second;\r\n\r\n  return [year, month, day, hour, minute, second].join(\"\");\r\n}\r\n\r\nmodule.exports = router;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}